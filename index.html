<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NAKA</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/jpeg" href="1772107040214.jpg">
    <meta name="theme-color" content="#007BFF">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="light">

    <div id="biometric-screen" class="hidden">
        <div class="bio-content">
            <span class="material-icons bio-icon" style="font-size: 80px; color: #007BFF;">face</span>
            <h2 style="margin-top: 20px;">NAKA Secure</h2>
            <button class="btn-main" onclick="unlockApp()" style="width: auto; padding: 15px 40px; margin-top: 20px;">ВХОД</button>
        </div>
    </div>

    <div id="auth-screen">
        <div class="auth-card">
            <div class="logo" style="background: url('1772107040214.jpg'); background-size: cover; border-radius: 50%; width: 80px; height: 80px; margin: 0 auto 20px;"></div>
            <h2>NAKA</h2>
            <input type="text" id="user-name" placeholder="Ваше имя...">
            <button class="btn-main" onclick="login()">ВОЙТИ</button>
        </div>
    </div>

    <div id="main-screen" class="hidden">
        <header>
            <div id="header-default">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <h1 style="margin:0; font-size: 24px;">NAKA</h1>
                    <div id="online-indicator"></div>
                </div>
                <div style="display: flex; gap: 15px;">
                    <span class="material-icons" onclick="toggleSearch(true)">search</span>
                    <span class="material-icons" onclick="logout()">exit_to_app</span>
                </div>
            </div>
            <div id="header-search" class="hidden">
                <span class="material-icons" onclick="toggleSearch(false)">arrow_back</span>
                <input type="text" id="search-input" placeholder="Поиск..." oninput="globalSearch()">
            </div>
        </header>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('chats')">ЧАТЫ</div>
            <div class="tab" onclick="switchTab('profile')">ПРОФИЛЬ</div>
        </div>

        <div id="tab-chats" class="chat-list"></div>
        <button id="add-contact-btn" onclick="promptAddContact()"><span class="material-icons">person_add</span></button>

        <div id="tab-profile" class="hidden">
            <div id="profile-container" style="padding: 20px; text-align: center;">
                <img id="my-avatar" src="1772107040214.jpg" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid #007BFF;">
                <h2 id="profile-name-display" style="margin-top: 15px;">Имя</h2>
                <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 20px;">
                    <button class="btn-main" onclick="showMyQR()" style="background: #333;">
                        <span class="material-icons">qr_code</span> Мой QR-код
                    </button>
                </div>
                <div class="settings-item" onclick="toggleDarkMode()" style="margin: 20px 0; display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 10px;">
                    <span>Темная тема</span>
                    <span class="material-icons">brightness_4</span>
                </div>
            </div>
        </div>
    </div>

    <div id="chat-window" class="hidden">
        <div class="chat-header">
            <span class="material-icons" onclick="closeChat()">arrow_back</span>
            <div class="chat-info" style="flex: 1; margin-left: 10px;">
                <span id="chat-title">Чат</span>
            </div>
            <div class="header-icons">
                <span class="material-icons" onclick="startCall('voice')">call</span>
            </div>
        </div>
        <div id="messages"></div>
        <div class="footer">
            <span class="material-icons">sentiment_satisfied_alt</span>
            <input type="text" id="msg-input" placeholder="Сообщение">
            <button id="send-btn" onclick="sendMessage()"><span class="material-icons">send</span></button>
        </div>
    </div>

    <div id="qr-modal" class="hidden" onclick="this.classList.add('hidden')">
        <div class="menu-content" style="text-align:center;">
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NAKA</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        /* ГЛАВНЫЕ ПРАВИЛА */
        :root { --blue: #007BFF; --bg: #f4f7f9; }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: sans-serif; background: var(--bg); height: 100vh; overflow: hidden; }
        .hidden { display: none !important; }

        /* ЭКРАНЫ */
        .screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 10; display: flex; flex-direction: column; }
        
        /* БИОМЕТРИЯ И ВХОД */
        #biometric-screen, #auth-screen { justify-content: center; align-items: center; text-align: center; z-index: 100; background: linear-gradient(135deg, #007BFF, #0056b3); color: white; }
        .card { background: white; padding: 30px; border-radius: 20px; color: #333; width: 85%; max-width: 320px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }

        /* ШАПКА */
        header { background: var(--blue); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        
        /* ВКЛАДКИ */
        .tabs { display: flex; background: white; border-bottom: 1px solid #ddd; }
        .tab { flex: 1; text-align: center; padding: 15px; font-weight: bold; color: #888; }
        .tab.active { color: var(--blue); border-bottom: 3px solid var(--blue); }

        /* СПИСОК ЧАТОВ */
        .chat-list { flex: 1; overflow-y: auto; background: white; }
        .chat-item { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #eee; }
        .avatar { width: 45px; height: 45px; border-radius: 50%; background: var(--blue); color: white; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold; }

        /* КНОПКИ */
        .btn-main { background: var(--blue); color: white; border: none; padding: 12px 25px; border-radius: 10px; font-weight: bold; width: 100%; margin-top: 10px; cursor: pointer; }
        #add-contact-btn { position: fixed; bottom: 30px; right: 25px; width: 60px; height: 60px; border-radius: 50%; background: var(--blue); color: white; border: none; box-shadow: 0 5px 15px rgba(0,0,0,0.3); display: flex; justify-content: center; align-items: center; z-index: 50; }

        /* МОДАЛКИ */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; display: flex; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 25px; border-radius: 20px; width: 90%; max-width: 350px; }
        
        /* ОКНО ЧАТА */
        #chat-window { z-index: 150; }
        #messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; background: #e5ddd5; }
        .bubble { padding: 8px 12px; border-radius: 10px; margin: 5px 0; max-width: 80%; }
        .bubble.in { align-self: flex-start; background: white; }
        .bubble.out { align-self: flex-end; background: #dcf8c6; }
        .chat-footer { padding: 10px; background: white; display: flex; gap: 10px; }
        .chat-footer input { flex: 1; border: 1px solid #ddd; padding: 10px; border-radius: 20px; outline: none; }
    </style>
</head>
<body>

    <div id="biometric-screen" class="screen">
        <div class="card">
            <span class="material-icons" style="font-size: 60px; color: var(--blue);">fingerprint</span>
            <h2>NAKA Secure</h2>
            <button class="btn-main" onclick="unlockApp()">ВОЙТИ</button>
        </div>
    </div>

    <div id="auth-screen" class="screen hidden">
        <div class="card">
            <div style="width:70px; height:70px; background: url('1772107040214.jpg'); background-size: cover; margin: 0 auto 15px; border-radius: 50%;"></div>
            <h3>Добро пожаловать</h3>
            <input type="text" id="user-name" placeholder="Ваше имя" style="width:100%; padding:10px; margin-bottom:15px; border-radius:8px; border:1px solid #ddd;">
            <button class="btn-main" onclick="login()">НАЧАТЬ ЧАТ</button>
        </div>
    </div>

    <div id="main-screen" class="screen hidden">
        <header>
            <h1 style="margin:0; font-size: 20px;">NAKA</h1>
            <span class="material-icons" onclick="logout()">exit_to_app</span>
        </header>
        <div class="tabs">
            <div class="tab active" onclick="switchTab('chats')">ЧАТЫ</div>
            <div class="tab" onclick="switchTab('profile')">ПРОФИЛЬ</div>
        </div>
        <div id="tab-chats" class="chat-list"></div>
        <button id="add-contact-btn" onclick="openModal('add-modal')"><span class="material-icons">add</span></button>
    </div>

    <div id="chat-window" class="screen hidden">
        <header>
            <span class="material-icons" onclick="closeChat()">arrow_back</span>
            <span id="chat-title" style="flex:1; margin-left:15px; font-weight:bold;">Чат</span>
        </header>
        <div id="messages"></div>
        <div class="chat-footer">
            <input type="text" id="msg-input" placeholder="Сообщение...">
            <button onclick="sendMessage()" style="background:none; border:none; color:var(--blue);"><span class="material-icons">send</span></button>
        </div>
    </div>

    <div id="add-modal" class="modal hidden" onclick="closeModal('add-modal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3>Найти человека</h3>
            <input type="tel" id="new-phone" placeholder="Номер телефона" style="width:100%; padding:10px; margin-bottom:10px; border-radius:8px; border:1px solid #ddd;">
            <button class="btn-main" onclick="confirmAddContact()">СОЗДАТЬ ЧАТ</button>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Небольшие правки логики прямо здесь для надежности
        function unlockApp() { 
            document.getElementById('biometric-screen').classList.add('hidden');
            if(!localStorage.getItem('naka_user')) {
                document.getElementById('auth-screen').classList.remove('hidden');
            } else {
                document.getElementById('main-screen').classList.remove('hidden');
                renderChats();
            }
        }
    </script>
</body>
</html>

